<!DOCTYPE html>
<html>
<head>
    <title></title>
    <style type="text/css">
        #compass{
            border-radius: 50%;
        }
    </style>
</head>
<body>

<img src="https://lh3.googleusercontent.com/bGUeJS-wGdOnZNwGSv0Mxztth6hTaV6K5kMsysSLpaVbNnsC4ghu_Vb8qBmeCZ3Dne2H" width="100" height="100" id="compass">
<p>X reading<span id="xreading"></span></p>
<p>Y reading<span id="yreading"></span></p>
<p>Z reading<span id="zreading"></span></p>
<p>D reading<span id="dreading2"></span></p>
<p>Angle reading<span id="dreading3"></span></p>
<script>

let sensor = new Magnetometer();
sensor.start();
sensor.onreading = () => {
    document.getElementById('xreading').innerHTML = sensor.x;
    document.getElementById('yreading').innerHTML = sensor.y;
    document.getElementById('zreading').innerHTML = sensor.z;
    // alert("Magnetic field along the X-axis " + sensor.x);
    // alert("Magnetic field along the Y-axis " + sensor.y);
    // alert("Magnetic field along the Z-axis " + sensor.z);
    let angle;
    let x = sensor.x;
    let y = sensor.y;

    if (Math.atan2(y, x) >= 0) {
        angle = Math.atan2(y, x) * (180 / Math.PI);
    }
    else {
        angle = (Math.atan2(y, x) + 2 * Math.PI) * (180 / Math.PI);
    }
    // d1 = Math.atan2(sensor.y, sensor.x) * 180 / Math.PI;

    // if (d1 < 0) d1 += 360;
    // if (d1 > 360) d1 -= 360;

    document.getElementById('dreading2').innerHTML = angle;

    let angle1 = Math.atan2(y, x);;
    angle1 = angle1 * (180 / Math.PI);
    angle1 = angle1 + 90;
    angle1 = (angle1 +360) % 360;
    angle1 = (angle1 + 180) % 360

    document.getElementById('dreading3').innerHTML = angle1;

    rotate = 360 - angle1;

    compass = document.getElementById('compass');
    compass.style.transform = "rotate("+rotate+"deg)";
};

sensor.onerror = event => alert(event.error.name, event.error.message);
</script>
</body>
</html>
