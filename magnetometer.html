<!DOCTYPE html>
<html>
<head>
    <title></title>
    <style type="text/css">
        #compass{
            border-radius: 50%;
        }

        #map {
            height: 40%;
        }

        html, body {
            height: 100%;
            margin: 0;
            padding: 0;
        }
    </style>
</head>
<body>

<div id="map"></div>
<img src="https://lh3.googleusercontent.com/bGUeJS-wGdOnZNwGSv0Mxztth6hTaV6K5kMsysSLpaVbNnsC4ghu_Vb8qBmeCZ3Dne2H" width="100" height="100" id="compass">
<p>X reading<span id="xreading"></span></p>
<p>Y reading<span id="yreading"></span></p>
<p>Angle reading<span id="dreading3"></span></p>
<script
  src="https://maps.googleapis.com/maps/api/js?key=AIzaSyB41DRUbKWJHPxaFjMAwdrzWzbVKartNGg&callback=initMap"
  async
></script>
<script>

function initMap() {
  const myLatLng = { lat: 1.3521, lng: 103.8198 };
  const map = new google.maps.Map(document.getElementById("map"), {
    zoom: 10,
    center: myLatLng,
  });

  if (navigator.geolocation) {
    position = navigator.geolocation.getCurrentPosition((position) => {
          const pos = {
            lat: position.coords.latitude,
            lng: position.coords.longitude,
          };
          console.log(pos);
          map.setCenter(pos);
          map.setZoom(13);
          new google.maps.Marker({
            position: pos,
            map,
            title: "My Location",
          });
    }, (msg)=>{ alert('Please enable your GPS position feature.'); },

    { maximumAge: 10000, timeout: 5000, enableHighAccuracy: true});

  }
}

let sensor = new Magnetometer();
sensor.start();
sensor.onreading = () => {
    document.getElementById('xreading').innerHTML = sensor.x;
    document.getElementById('yreading').innerHTML = sensor.y;
    // alert("Magnetic field along the X-axis " + sensor.x);
    // alert("Magnetic field along the Y-axis " + sensor.y);
    // alert("Magnetic field along the Z-axis " + sensor.z);
    let x = sensor.x;
    let y = sensor.y;

    let angle = Math.atan2(y, x) * (180 / Math.PI);
    if(angle < 0) angle = 360 + angle;
    rotate = 360 - angle;

    document.getElementById('dreading3').innerHTML = rotate;

    compass = document.getElementById('compass');
    compass.style.transform = "rotate("+rotate+"deg)";
};

sensor.onerror = event => alert(event.error.name, event.error.message);
</script>
</body>
</html>
